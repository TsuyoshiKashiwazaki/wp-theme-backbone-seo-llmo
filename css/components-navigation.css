/* ========================================
   ナビゲーション
======================================== */
body .main-navigation ul {
    list-style: none;
    display: flex;
    flex-wrap: wrap;
    gap: 1px;
    position: relative;
    /* ナビゲーションの縦スクロールを防止 */
    overflow: visible;
    overflow-y: visible;
    min-height: auto;
    max-height: none;
}

body .main-navigation {
    /* ナビゲーション全体の縦スクロールを防止 */
    overflow: visible;
    overflow-y: visible;
    min-height: auto;
    max-height: none;
    /* 背景を透明に設定 */
    background: transparent !important;
}

/* 各メニュー項目に下線装飾を適用（トップレベルのみ） */
body .main-navigation > ul > li::after {
    content: '';
    position: absolute;
    bottom: -5px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 2px;
    background: rgba(0, 0, 0, 0.2);
    transition: width 0.3s ease;
}

body .main-navigation > ul > li:hover::after {
    width: 80%;
}

/* サブメニュー項目のホバー下線（テキストの真下に表示） */
body .main-navigation .sub-menu li {
    position: relative;
}

body .main-navigation .sub-menu a {
    position: relative; /* 下線を正しく配置するため */
}

body .main-navigation .sub-menu a::after {
    content: '';
    position: absolute;
    bottom: 8px; /* パディング内でテキストの真下に配置 */
    left: 20px;
    right: 20px;
    height: 1px;
    background: var(--header-link-hover-color);
    transform: scaleX(0);
    transform-origin: left center;
    transition: transform 0.2s ease;
}

body .main-navigation .sub-menu a:hover::after {
    transform: scaleX(1);
}

body .main-navigation li {
    position: relative;
}

body .main-navigation a {
    color: var(--header-link-color);
    text-decoration: none;
    /* font-weight はタイポグラフィパターンで管理 */
    padding: 10px 15px;
    /* border-radius はデコレーションパターンで管理 */
    transition: all 0.2s ease;
    display: block;
    border: 1px solid transparent;
    white-space: normal;
    word-wrap: break-word;
    hyphens: auto;
    line-height: 1.1;
}

body .main-navigation a:hover {
    color: var(--header-link-hover-color);
    border-color: transparent;
}

/* サブメニュー（ドロップダウン） */
body .main-navigation .sub-menu {
    position: absolute;
    top: 100%;
    left: 0;
    margin-top: 0 !important; /* 隙間をなくす */
    background: var(--primary-color); /* グローバルメニューと同じCSS変数 */
    color: var(--header-link-color);
    min-width: 220px; /* パネル用に少し幅を広げる */
    padding: 0 6px 6px 6px !important; /* 上は0、他は6px - 親メニューとの隙間をなくす */
    /* border-radius はデコレーションパターンで管理 */
    border: none; /* ボーダーも削除 */
    opacity: 0;
    visibility: hidden;
    transform: translateY(0);
    transition: opacity 0.3s ease, visibility 0.3s ease;
    z-index: 9999;
    display: block;
    flex-direction: column;
    gap: 0;
    /* メインコンテンツにめり込まないようにする */
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    background: var(--primary-color); /* グローバルメニューと同じCSS変数 */
}

/* フルワイドレイアウトでのサブメニュー表示修正 */
body.layout-full-width .main-navigation .sub-menu {
    z-index: 99999;
    /* フルワイドレイアウトではより高いz-indexを設定 */
    position: absolute;
    top: 100%;
    left: 0;
    margin-top: 0; /* 隙間をなくす */
    /* メインコンテンツにめり込まないようにする */
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    background: var(--primary-color); /* グローバルメニューと同じCSS変数 */
    border-radius: 0;
    border: none; /* ボーダーも削除 */
    padding: 0 6px 6px 6px; /* 上は0、他は6px */
}

/* フルワイドレイアウトでの3階層目以降のサブメニュー表示 - 横展開（右側表示） */
body.layout-full-width.submenu-third-horizontal .main-navigation .sub-menu .sub-menu {
    position: absolute !important;
    top: 0 !important; /* パネルを垂直に揃える */
    left: 100% !important; /* 親パネルに隣接 */
    z-index: 999999 !important;
    /* より高い優先度でデスクトップでの右側表示を確保 */
    transform: none !important;
    opacity: 0;
    visibility: hidden;
    margin: 0 !important;
    padding: 6px !important; /* パネル用の余白 */
    background: var(--primary-color) !important; /* ヘッダーと同じ背景色 */
    border: none !important; /* border削除 */
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15) !important;
    min-width: 200px !important;
    display: block !important;
    flex-direction: column !important;
    width: auto !important;
}

/* 3階層目サブメニューの左側に透明なホバー領域を追加（横展開時） */
body.layout-full-width.submenu-third-horizontal .main-navigation .sub-menu .sub-menu::before {
    content: '';
    position: absolute;
    top: -20px;
    left: -30px; /* 親サブメニューとの隙間をカバー（広げた） */
    width: 40px;
    height: calc(100% + 40px);
    background: transparent;
}

/* フルワイドレイアウトでの3階層目以降のサブメニュー表示 - 縦展開（直下表示） */
body.layout-full-width.submenu-third-vertical .main-navigation .sub-menu .sub-menu {
    position: static !important;
    top: auto !important;
    left: auto !important;
    z-index: 9999999 !important; /* より高いz-indexで下のメニューに重ねる */
    transform: none !important;
    margin: 0 0 0 16px !important; /* 上マージンを削除してパネル同士を密着 */
    padding: 6px !important; /* パネル用の余白を追加 */
    background: var(--primary-color) !important; /* 透明化せず背景色を設定 */
    border: none !important; /* すべてのborder削除 */
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15) !important; /* 影を追加して浮き上がり効果 */
    min-width: auto !important;
    display: none !important; /* 初期状態は非表示にしてスペースを占有しないようにする */
    flex-direction: column !important;
    width: 100% !important;
}

/* 4階層目以降も同じルールを継承（横展開） */
body.layout-full-width.submenu-third-horizontal .main-navigation .sub-menu .sub-menu .sub-menu,
body.layout-full-width.submenu-third-horizontal .main-navigation .sub-menu .sub-menu .sub-menu .sub-menu,
body.layout-full-width.submenu-third-horizontal .main-navigation .sub-menu .sub-menu .sub-menu .sub-menu .sub-menu {
    /* 3階層目と同じスタイルを継承 */
}

/* 4階層目以降も同じルールを継承（縦展開） - さらにインデントを追加 */
body.layout-full-width.submenu-third-vertical .main-navigation .sub-menu .sub-menu .sub-menu {
    margin-left: 32px !important; /* 4階層目はさらにインデント */
}
body.layout-full-width.submenu-third-vertical .main-navigation .sub-menu .sub-menu .sub-menu .sub-menu {
    margin-left: 48px !important; /* 5階層目はさらにインデント */
}
body.layout-full-width.submenu-third-vertical .main-navigation .sub-menu .sub-menu .sub-menu .sub-menu .sub-menu {
    margin-left: 64px !important; /* 6階層目はさらにインデント */
}

/* フルワイドレイアウト - 横展開時のホバー表示 */
body.layout-full-width.submenu-third-horizontal .main-navigation .sub-menu .menu-item-has-children:hover > .sub-menu,
body.layout-full-width.submenu-third-horizontal .main-navigation .sub-menu .menu-item-has-children.submenu-active > .sub-menu {
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
}

/*
 * disabled-pointer クラスは削除しました
 * 以前は3階層目以降のサブメニュー表示時に兄弟項目を無効化していましたが、
 * これにより他のメニュー項目がクリックできなくなる問題がありました。
 * 代わりにz-indexで対処します。
 */

/* フルワイドレイアウト - 縦展開時のホバー表示 */
body.layout-full-width.submenu-third-vertical .main-navigation .sub-menu .menu-item-has-children:hover > .sub-menu,
body.layout-full-width.submenu-third-vertical .main-navigation .sub-menu .menu-item-has-children.submenu-active > .sub-menu {
    display: block !important; /* ホバー時に表示 */
}

body .main-navigation li:hover>.sub-menu,
body .main-navigation li.submenu-active>.sub-menu {
    opacity: 1;
    visibility: visible;
}

/* サブメニューの上部に透明なホバー領域を追加（親メニューとの隙間対策） */
body .main-navigation .sub-menu::before {
    content: '';
    position: absolute;
    top: -15px;
    left: 0;
    width: 100%;
    height: 15px;
    background: transparent;
}

body .main-navigation .sub-menu li {
    width: 100%;
    margin: 0; /* 隙間をなくす */
    position: relative;
}

/* サブメニュー項目のリンクにホバー領域を拡張（項目間の隙間対策） */
body .main-navigation .sub-menu li a {
    /* パディングを増やしてホバー領域を広げる */
    margin: -2px 0; /* 負のマージンで項目を重ねる */
    padding-top: 14px; /* 上パディングを増加 */
    padding-bottom: 14px; /* 下パディングを増加 */
}

/* 最初のサブメニュー項目は上マージンなし - 親メニューとの隙間をなくす */
body .main-navigation .sub-menu li:first-child {
    margin-top: 0 !important;
}

body .main-navigation .sub-menu a {
    color: var(--header-link-color); /* ヘッダーリンクと同じ色 */
    padding: 12px 20px; /* 適度なパディング */
    border-radius: 0; /* シャープなエッジでモダンなパネル感 */
    /* font-weight はタイポグラフィパターンで管理 */
    transition: all 0.2s ease;
    display: block;
    margin: 0; /* マージンを削除 */
    background: var(--primary-color); /* グローバルメニューと同じCSS変数 */
    border-left: 3px solid transparent; /* 左ボーダーでアクセント */
    border-bottom: 1px solid rgba(255, 255, 255, 0.08); /* 薄いボーダーで区切り線 */
    position: relative;
    /* サブメニューは折り返さない */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 220px; /* 最大幅を設定して省略記号を表示 */
}

body .main-navigation .sub-menu li:last-child a {
    border-bottom: none; /* 最後のアイテムは下ボーダーなし */
}

body .main-navigation .sub-menu a:hover {
    color: var(--header-link-hover-color); /* メインメニューと同じオレンジ系の色 */
    background: color-mix(in srgb, var(--primary-color) 85%, black); /* CSS変数での暗い色 */
    border-left-color: var(--header-link-hover-color); /* 左ボーダーをオレンジに */
    padding-left: 24px; /* 少し内側にずらしてインタラクティブ感 */
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* 軽い外側の影で浮き上がり効果 */
}

/* サブメニューの矢印アイコン */
body .main-navigation .menu-item-has-children>a {
    position: relative;
    padding-left: 2em; /* 左側に+記号用のスペースを確保 */
}

body .main-navigation .menu-item-has-children>a::before {
    content: "+";
    position: absolute;
    left: 0.5em;
    top: 50%;
    transform: translateY(-50%);
    transition: content 0.2s ease;
    font-weight: bold;
}

body .main-navigation .menu-item-has-children:hover>a::before {
    content: "-";
}

/* ハンバーガーメニューの基本レイアウト改善 */
body .main-navigation ul.active {
    /* 基本レイアウト */
    display: flex;
    flex-direction: column;
    gap: 0;

    /* メニューパネルの基本スタイル（カラーテーマのヘッダー色を使用） */
    background: var(--background-color);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    padding: 16px;
    min-width: 260px;
    margin-top: 8px;

    /* 位置とサイズ */
    width: auto;
    text-align: left;
    position: relative;
    top: auto;
    left: auto;
    z-index: 10001;
    /* メインコンテンツにめり込まないようにする */
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
}

/* フルワイドレイアウトでのハンバーガーメニュー表示修正 */
body .layout-full-width .main-navigation ul.active {
    z-index: 999999;
    /* フルワイドレイアウトではより高いz-indexを設定 */
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
}

/* メインメニュー項目の差別化 */
body .main-navigation ul.active>li {
    margin: 0 0 8px 0;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--border-color);
}

body .main-navigation ul.active>li:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

body .main-navigation ul.active>li>a {
    display: block;
    padding: 12px 16px;
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-color); /* ハンバーガーメニューでは通常のテキスト色を使用 */
    text-decoration: none;
    border-radius: 4px;
    background: var(--background-color); /* 個別項目に背景を追加 */
}

body .main-navigation ul.active>li>a:hover {
    background: rgba(0, 0, 0, 0.05);
    color: var(--text-color);
}

/* サブメニューの差別化 */
body .main-navigation ul.active .sub-menu {
    margin: 8px 0 0 0;
    padding: 0 0 0 20px;
    /* border削除 */
}

body .main-navigation ul.active .sub-menu li {
    margin: 0 0 8px 0;
    /* border削除 */
}

body .main-navigation ul.active .sub-menu li:last-child {
    /* border削除 */
}

body .main-navigation ul.active .sub-menu a {
    display: block;
    padding: 8px 16px;
    font-size: 0.9rem;
    font-weight: 400;
    color: var(--header-link-color); /* ヘッダーリンクと同じ色 */
    text-decoration: none;
    background: var(--primary-color); /* グローバルメニューと同じCSS変数 */
    border: none;
    border-radius: 0;
}

body .main-navigation ul.active .sub-menu a:hover {
    background: color-mix(in srgb, var(--primary-color) 85%, black); /* CSS変数での暗い色 */
    border: none;
    color: var(--header-link-hover-color);
}

/* 3階層目以降のサブメニュー - 横展開（右側表示） - フルワイドレイアウトを除く */
body:not(.layout-full-width).submenu-third-horizontal .main-navigation .sub-menu .sub-menu {
    position: absolute;
    top: 0; /* パネルを垂直に揃える */
    left: 100%; /* 隙間なくパネルを接続 */
    margin: 0;
    transform: translateY(0);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
    z-index: 99999;
    background: var(--primary-color); /* グローバルメニューと同じCSS変数 */
    border: none; /* border削除 */
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    min-width: 200px;
    padding: 0;
}

/* 3階層目サブメニューの左側に透明なホバー領域を追加（横展開時） - フルワイドレイアウトを除く */
body:not(.layout-full-width).submenu-third-horizontal .main-navigation .sub-menu .sub-menu::before {
    content: '';
    position: absolute;
    top: -20px;
    left: -30px; /* 親サブメニューとの隙間をカバー（広げた） */
    width: 40px;
    height: calc(100% + 40px);
    background: transparent;
}

/* 3階層目以降のサブメニュー - 縦展開（直下表示） - フルワイドレイアウトを除く */
body:not(.layout-full-width).submenu-third-vertical .main-navigation .sub-menu .sub-menu {
    position: static;
    top: auto;
    left: auto;
    margin: 0 0 0 16px;
    transform: none;
    transition: all 0.3s ease;
    z-index: 9999999; /* より高いz-indexで下のメニューに重ねる */
    background: var(--primary-color); /* 透明化せず背景色を設定 */
    border: none; /* すべてのborder削除 */
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15); /* 影を追加して浮き上がり効果 */
    min-width: auto;
    padding: 6px; /* パネル用の余白を追加 */
    width: 100%;
    display: none; /* 初期状態は非表示にしてスペースを占有しないようにする */
}

/* 縦展開時の3階層目親要素に::afterでホバー領域を拡張 */
body:not(.layout-full-width).submenu-third-vertical .main-navigation .sub-menu .menu-item-has-children {
    position: relative;
}

/* 縦展開時：子サブメニューを持つ項目はz-indexを上げて、展開時に下の項目を覆う */
/* ::afterでのホバー領域拡張は他のメニュー項目を覆ってしまうので使用しない */

/* 4階層目以降も同じルールを継承（横展開） */
body:not(.layout-full-width).submenu-third-horizontal .main-navigation .sub-menu .sub-menu .sub-menu,
body:not(.layout-full-width).submenu-third-horizontal .main-navigation .sub-menu .sub-menu .sub-menu .sub-menu,
body:not(.layout-full-width).submenu-third-horizontal .main-navigation .sub-menu .sub-menu .sub-menu .sub-menu .sub-menu {
    /* 3階層目と同じスタイルを継承 */
}

/* 4階層目以降も同じルールを継承（縦展開） - さらにインデントを追加 */
body:not(.layout-full-width).submenu-third-vertical .main-navigation .sub-menu .sub-menu .sub-menu {
    margin-left: 32px; /* 4階層目はさらにインデント */
}
body:not(.layout-full-width).submenu-third-vertical .main-navigation .sub-menu .sub-menu .sub-menu .sub-menu {
    margin-left: 48px; /* 5階層目はさらにインデント */
}
body:not(.layout-full-width).submenu-third-vertical .main-navigation .sub-menu .sub-menu .sub-menu .sub-menu .sub-menu {
    margin-left: 64px; /* 6階層目はさらにインデント */
}

body:not(.layout-full-width).submenu-third-horizontal .main-navigation .sub-menu .menu-item-has-children:hover > .sub-menu {
    opacity: 1;
    visibility: visible;
}

body:not(.layout-full-width).submenu-third-vertical .main-navigation .sub-menu .menu-item-has-children:hover > .sub-menu,
body:not(.layout-full-width).submenu-third-vertical .main-navigation .sub-menu .menu-item-has-children.submenu-active > .sub-menu {
    display: block; /* ホバー時またはsubmenu-activeクラスで表示 */
}

/* サブメニューの矢印 - 横展開時はプラス */
body.submenu-third-horizontal .main-navigation .sub-menu .menu-item-has-children>a {
    position: relative;
    padding-left: 2em;
}

body.submenu-third-horizontal .main-navigation .sub-menu .menu-item-has-children>a::before {
    content: "+";
    position: absolute;
    left: 0.5em;
    top: 50%;
    transform: translateY(-50%) !important;
    transition: content 0.2s ease;
    font-weight: bold;
}

body.submenu-third-horizontal .main-navigation .sub-menu .menu-item-has-children:hover>a::before {
    content: "-";
}

/* サブメニューの矢印 - 縦展開時はプラス */
body.submenu-third-vertical .main-navigation .sub-menu .menu-item-has-children>a {
    position: relative;
    padding-left: 2em;
}

body.submenu-third-vertical .main-navigation .sub-menu .menu-item-has-children>a::before {
    content: "+";
    position: absolute;
    left: 0.5em;
    top: 50%;
    transform: translateY(-50%) !important;
    transition: content 0.2s ease;
    font-weight: bold;
}

body.submenu-third-vertical .main-navigation .sub-menu .menu-item-has-children:hover>a::before {
    content: "-";
}

/* 3階層目のサブメニュー（モバイル用） - デスクトップでは適用しない */
@media (max-width: 1279px) {
    body .main-navigation ul.active .sub-menu .sub-menu {
        margin: 4px 0 0 0;
        padding: 0 0 0 18px;
        /* border削除 */
        position: static;
        opacity: 1;
        visibility: visible;
    }

    body .main-navigation ul.active .sub-menu .sub-menu li {
        /* border削除 */
    }

    body .main-navigation ul.active .sub-menu .sub-menu li:last-child {
        /* border削除 */
    }

    body .main-navigation ul.active .sub-menu .sub-menu a {
        padding: 6px 14px;
        font-size: 0.85rem;
        font-weight: 300;
        color: var(--header-link-color); /* ヘッダーリンクと同じ色 */
        background: var(--primary-color); /* グローバルメニューと同じCSS変数 */
        border: none;
        border-radius: 0;
    }

    body .main-navigation ul.active .sub-menu .sub-menu a:hover {
        background: color-mix(in srgb, var(--primary-color) 85%, black); /* CSS変数での暗い色 */
        border: none;
        color: var(--header-link-hover-color);
    }
}

/* メニュー項目のアイコン */
body .main-navigation ul.active .menu-item-has-children>a::after {
    content: '▼';
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.6rem;
    color: var(--text-light);
    opacity: 0.6;
}

/* アクティブなメニュー項目 */
body .main-navigation ul.active .current-menu-item>a,
body .main-navigation ul.active .current_page_item>a {
    background: rgba(0, 0, 0, 0.1);
    color: var(--text-color);
    font-weight: 700;
    position: relative;
    z-index: 9998;
}

/* アクティブなメニュー項目に小さなマーク（«）を追加 */
body .main-navigation ul.active .current-menu-item>a::after,
body .main-navigation ul.active .current_page_item>a::after {
    content: '«';
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.8rem;
    color: var(--text-color);
    font-weight: bold;
    text-shadow: 0 0 2px rgba(0, 0, 0, 0.3);
    display: block;
    visibility: visible;
    opacity: 1;
    z-index: 9999;
}

/* サブメニュー内のアクティブ項目にも小さなマーク（«）を追加 */
body .main-navigation ul.active .sub-menu .current-menu-item>a::after,
body .main-navigation ul.active .sub-menu .current_page_item>a::after {
    content: '«';
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.7rem;
    color: var(--text-color);
    font-weight: bold;
    text-shadow: 0 0 2px rgba(0, 0, 0, 0.3);
}

/* 3階層目のサブメニュー内のアクティブ項目にも小さなマーク（«）を追加 */
body .main-navigation ul.active .sub-menu .sub-menu .current-menu-item>a::after,
body .main-navigation ul.active .sub-menu .sub-menu .current_page_item>a::after {
    content: '«';
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.65rem;
    color: var(--text-color);
    font-weight: bold;
    text-shadow: 0 0 2px rgba(0, 0, 0, 0.3);
}

/* モバイルメニューのスタイルはJSONファイルで管理 */
